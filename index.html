<html>

<head>
    <title>a funny rubik cubic game</title>
    <link rel=StyleSheet href="./styles.css" type="text/css" media=screen>
    <script src="https://kit.fontawesome.com/20496c3b97.js" crossorigin="anonymous"></script>
</head>

<body>
    <section class="cubic__wrapper">
        <h1 class="cubic__title">The Rubik Cube</h1>
        <div class="cubic__main" id="cubic-selected-area">
            <div class="cubic" id="cubic"></div>
        </div>
    </section>

    <section class="action-bar">
        <div class="action-bar__rotation-icons">
            <i class="fas fa-arrow-circle-left" onclick="rotate('left')"></i>
            <i class="fas fa-arrow-circle-up" onclick="rotate('top')"></i>
            <i class="fas fa-arrow-circle-right" onclick="rotate('right')"></i>
        </div>
        <div class="action-bar__buttons">
            <button id="animate-button" class="action-bar__animate-button">Lets spin!</button>
            <button id="grab-button" class="action-bar__grab-button">Grab</button>
        </div>
    </section>
    <footer>

    </footer>
</body>
<script>
    // grab all necesary elements
    const cubic = document.getElementById("cubic");
    const selectedArea = document.getElementById("cubic-selected-area");
    const animateButton = document.getElementById("animate-button");
    const grabButton = document.getElementById("grab-button");
</script>

<script>
    // set all face with his respective pieces

    const matrix = [];

    const MATRIX_COLORS = ['blue', 'red', 'white', 'orange', 'green', 'yellow'];
    const AMOUNT_PIECES_BY_FACE = 9;

    MATRIX_COLORS.forEach((color, index) => {
        const face = document.createElement('div');
        face.className = `cubic__face cubic__face--${index+1}`;

        let counter = 0;
        const faceData = [];

        while (counter < AMOUNT_PIECES_BY_FACE) {
            faceData.push(color);
            const piece = document.createElement('div');
            piece.id = `cubic-piece-${index +1}-${counter +1}`;
            piece.className = `cubic__piece cubic__piece--${color}`;
            face.appendChild(piece);
            counter++;
        }
        matrix.push(faceData);
        cubic.appendChild(face);
    });
</script>

<script>
    let isRotating = false;
    let startPiece;
    let endPiece;

    const getPosition = (piece) => {
        return {
            face: piece.id.split('-')[2],
            cell: piece.id.split('-')[3]
        }
    };

    const findRotation = (startPiece, endPiece) => {
        const startPosition = getPosition(startPiece);
        const endPosition = getPosition(endPiece);

        console.log({
            startPosition,
            endPosition
        })
        console.log(matrix);
    };

    const logPiece = (event) => {
        const {
            type,
            target
        } = event;
        const targetClassNames = Array.from(target.classList);

        if (target && targetClassNames.includes('cubic__piece')) {
            isRotating = type === 'mousedown';
            if (isRotating) {
                startPiece = target;
            } else {
                endPiece = target
                findRotation(startPiece, endPiece)
            }
        }
    };

    selectedArea.addEventListener("mousedown", logPiece, false);
    selectedArea.addEventListener("mouseup", logPiece, false);
</script>

<script>
    let isSpining = false;

    const animate = () => {
        if (isSpining) {
            cubic.classList.remove("cubic--spin");
        } else {
            cubic.classList.add("cubic--spin");
        }
        isSpining = !isSpining
    };

    animateButton.addEventListener("click", animate, false);
</script>
<script>
    // rotate cubic on grab button click


    let isGrabbing = false;
    let xStartPosition;
    let yStartPosition;
    let xEndPosition;
    let yEndPosition;
    let startRoting = false;
    let xAngleRotate = 0;
    let yAngleRotate = 0;

    const setInitalValues = (e) => {
        xStartPosition = e.pageX;
        yStartPosition = e.pageY;
        startRoting = true;
    }

    const resetValues = (e) => {
        startRoting = false;
    }

    const rotateCubic = (e) => {
        if (startRoting) {
            xEndPosition = e.pageX;
            yEndPosition = e.pageY;
            xAngleRotate = ((xEndPosition - xStartPosition) * 2) * Math.PI / 360 + xAngleRotate;
            yAngleRotate = ((yEndPosition - yStartPosition) * 2) * Math.PI / 360 + yAngleRotate;

            cubic.style.transform = `rotateX(${-yAngleRotate}deg) rotateY(${xAngleRotate}deg)`;
        }
    }


    const switchGrabbing = () => {
        isGrabbing = !isGrabbing;

        if (isGrabbing) {
            // remove transition class
            if (cubic.classList.contains('cubic--auto-roting')) {
                cubic.classList.remove('cubic--auto-roting')
            }

            selectedArea.classList.add('cubic__main--grabing');
            selectedArea.addEventListener('mousedown', setInitalValues, false);
            selectedArea.addEventListener('mousemove', rotateCubic, false);
            window.addEventListener('mouseup', resetValues, false);
        } else {
            selectedArea.classList.remove('cubic__main--grabing');
            selectedArea.removeEventListener('mousedown', setInitalValues);
            selectedArea.removeEventListener('mousemove', rotateCubic);
            window.removeEventListener('mouseup', resetValues);
        }
    };

    grabButton.addEventListener("click", switchGrabbing)
</script>

<script>
    const getActualRotation = () => {
        const baseStyle = cubic.style.transform;

        if (!baseStyle) return {
            x: 0,
            y: 0
        }

        // grab all positive and negative numbers.
        const regex = /[-?\d|,|.\+]+/g;
        // grab all matches
        const values = baseStyle.match(regex);

        return {
            x: parseFloat(values[0]),
            y: parseFloat(values[1]),
        }
    };

    const rotate = (direction) => {
        //if grabbing is enabled, disable it 
        if (isGrabbing) {
            switchGrabbing();
        }

        if (!cubic.classList.contains('cubic--auto-roting')) {
            cubic.classList.add('cubic--auto-roting')
        }

        // get the actual rotation 
        const {
            x: xRotation,
            y: yRotation
        } = getActualRotation();

        let rotationStyle;
        switch (direction) {
            case 'left': {
                rotationStyle = `rotateX(${xRotation}deg) rotateY(${yRotation+90}deg)`
                break;
            }
            case 'right': {
                rotationStyle = `rotateX(${xRotation}deg) rotateY(${yRotation-90}deg)`
                break;
            }
            case 'top': {
                rotationStyle = `rotateX(${xRotation+180}deg) rotateY(${yRotation}deg)`
                break;
            }
            default: {
                rotationStyle = `rotateX(${xRotation}deg) rotateY(${yRotation}deg)`
                break;
            }
        }

        if (direction) {
            cubic.style.transform = rotationStyle;
        }
    }
</script>

</html>